<?xml version="1.0" encoding="utf-8"?>
<!-- FrameLayout allows control of z-index by declaration order -->
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:descendantFocusability="blocksDescendants">

    <!-- Layer 1: Game (Background - Always visible) -->
    <FrameLayout
        android:id="@+id/retroview_container"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:background="@android:color/black" />

    <!-- Layer 1.5: Load Preview Overlay (between game and menu) -->
    <!-- Full-screen screenshot shown when user selects a slot in Load State -->
    <ImageView
        android:id="@+id/load_preview_overlay"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:scaleType="fitXY"
        android:visibility="gone"
        android:importantForAccessibility="no" />

    <!-- Layer 2: Menu Container (Middle - Conditionally visible) -->
    <!-- This container will hold RetroMenu3Fragment and its submenus -->
    <FrameLayout
        android:id="@+id/menu_container"
        android:layout_width="match_parent"
        android:layout_height="match_parent" />

    <!-- Layer 3: GamePad (Bottom in portrait - Conditionally visible, always above menu) -->
    <!-- CRITICAL: elevation and translationZ ensure gamepad stays on top of menu -->
    <!-- visibility=invisible prevents flash during orientation changes (revealed via post{}) -->
    <LinearLayout
        android:id="@+id/containers"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_gravity="bottom"
        android:baselineAligned="false"
        android:orientation="horizontal"
        android:gravity="bottom"
        android:elevation="100dp"
        android:translationZ="100dp"
        android:visibility="invisible">

        <FrameLayout
            android:id="@+id/left_container"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="0.25" />

        <View
            android:layout_width="0dp"
            android:layout_height="0dp"
            android:layout_weight="0.5" />

        <FrameLayout
            android:id="@+id/right_container"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="0.25" />
    </LinearLayout>

    <!-- Layer 3.5: Floating Menu Button (Conditionally visible based on config) -->
    <Button
        android:id="@+id/floating_menu_button"
        android:layout_width="48dp"
        android:layout_height="48dp"
        android:layout_margin="16dp"
        android:contentDescription="@string/app_name"
        android:text="â˜°"
        android:textColor="@android:color/white"
        android:textSize="24sp"
        android:padding="0dp"
        android:gravity="center"
        android:background="@drawable/bg_floating_button"
        android:visibility="gone"
        android:elevation="150dp"
        android:translationZ="150dp" />

    <!-- Layer 4: Shutdown Animation Overlay (Topmost - Only visible during shutdown) -->
    <com.vinaooo.revenger.ui.splash.CRTBootView
        android:id="@+id/crt_shutdown_view"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:visibility="gone"
        android:elevation="200dp"
        android:translationZ="200dp"
        android:background="@android:color/black" />
</FrameLayout>